{% extends "base.html" %}

{% block styles %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="/static/css/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
{% endblock %}

{% block scripts %}
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="/static/js/leaflet.awesome-markers.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        const credits = '{{ _("Contribuidores do OpenStreetMap") }}';
        const bounds = {{ bounds|safe }};
        const whereAmIMsg = '{{ _("Mostre-me onde estou") }}';
        const localizeMsg = '{{ _("Localize no mapa") }}';
        const cancelMsg = '{{ _("Cancel") }}';
    </script>
    <script src='/static/js/geolocate.js' type="text/javascript"></script>
{% endblock %}

{% block title %}{{ _("Localize monumentos") }}{% endblock %}

{% block navbar %}
    {% with lang=lang, username=username, mapa_geral=True, mapa=True, geolocate=False, uf=uf, suggest=True %}
        {% include 'topnavbar.html' %}
    {% endwith %}
{% endblock %}

{% block banner %}{% endblock %}
{% block content %}
    <div class="w3-row" style="padding:30px 10px; ">
        <div class="w3-quarter">&nbsp;</div>
        <div class="w3-half">
            <label for="localFilter">{{ _('Filtre os monumentos da tabela pelo município em que estão localizados') }}</label>
            <input class="form-control" id="localFilter" type="text" placeholder="{{ _('Digite o nome de um município') }}">
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr style="text-align: center">
                <th>{{ _("Imagem") }}</th>
                <th>{{ _("Monumentos sem coordenadas") }}</th>
                <th id="addCoordinatesHeader">{{ _("Adicionar coordenadas") }}</th>
            </tr>
            </thead>
            <tbody id="monuments_table">
            {% for monument in monuments %}
                <tr>
                    <td style="padding:0.75em; vertical-align: middle; text-align: center; width:100px">
                        <img loading="lazy"
                             alt="{{ monument["label"] }}"
                             src="https://commons.wikimedia.org/wiki/Special:FilePath/{{ monument["imagem"] }}?width=100px">
                    </td>
                    <td style="vertical-align: middle">
                        <a target="_blank" href="https://www.wikidata.org/wiki/{{ monument['item'] }}">
                            {{ monument["label"] }}
                        </a><br>
                        <a target="_blank" href="https://www.wikidata.org/wiki/{{ monument['local'] }}">
                            {{ monument["local_label"] }}
                        </a><br>
                        <i style="font-size: 85%">{{ monument["endereço"] }}</i>
                    </td>
                    <td style="vertical-align: middle">
                        <button type="button" id="addTo{{ monument['item'] }}" class="custom btn btn-primary"
                                data-item="{{ monument['item'] }}"
                                data-label="{{ monument["label"] }}"
                                data-address="{{ monument["endereço"] }}"
                                data-local="{{ monument["local_label"] }}"
                                style="width:100%; min-height: 90px; height:100%">
                            <i class="fa-solid fa-map-pin"></i><br>{{ _('Adicionar coordenadas') }}
                        </button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addInfo" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="monument">{{ _("Adicionar coordenadas") }}</h5>
                    <button type="button" class="close custom" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body w3-container" style="height:calc(100hv - 148px);">
                    <div class="w3-row" style="font-size: 85%">
                        <span id="local"></span>
                        <span id="address"></span>
                    </div>
                    <div class="w3-row" style="text-align: center; margin-bottom: 15px">
                        <p>{{ _('Adicione coordenadas ao monumento clicando em <i class="fa-solid
                        fa-map-pin"></i> no mapa e em seguida posicionando o marcador.') }}</p>
                        <p>{{ _('') }}</p>
                    </div>
                    <div class="w3-row" style="height:300px; padding:0">
                        <div id="map" style="height:300px"></div>
                    </div>
                    <label class="col-auto col-form-label" for="latlng">{{ _("Coordenadas:") }}</label>
                    <div class="w3-row form-group row" style="margin:0">
                        <div class="col-10">
                            <input type="text" class="form-control" style="margin:0" id="latlng"/>
                        </div>
                        <div class="col-2">
                            <button id="latlngConfirm" type="button" class="custom btn btn-primary"
                                    style="width:100%; margin:0">
                                <i class="fa-solid fa-map-pin"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="custom btn btn-secondary" data-dismiss="modal">
                        {{ _("Cancelar") }}
                    </button>
                    <button id="addCoordinates" type="button" class="custom btn btn-primary"
                            data-dismiss="modal" data-lat="" data-lon="" onclick="postCoordinates();" disabled>
                        {{ _("Confirmar") }}
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block footer %}
    <footer style="text-align:left;position: relative;padding: 0 15px" id="footer">
        <hr>
        <p style="font-size:90%; text-align: justify">
            {% set projeto %}<a tabindex="0" target='_blank' aria-label='{{_("Wiki Movimento Brasil")}}' href='https://meta.wikimedia.org/wiki/Wiki_Movement_Brazil_User_Group/{{ lang }}'>{{_("Grupo de usuários Wiki Movimento Brasil")}}</a>{% endset %}
            {{_("<i>Wiki Loves Brasil</i> é um aplicativo desenvolvido pelo <i><b>%(projeto)s</b></i>, visando melhorar a experiência dos usuários que participam do concurso fotográfico Wiki Loves Monuments na localização e envio de fotografias para o Wikimedia Commons.", projeto=projeto)}}
        </p>
    </footer>
{% endblock %}